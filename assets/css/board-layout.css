/* Desktop: трехколоночная раскладка, поле по центру квадратом */
@media (min-width: 1025px) {
  #game-page,
  .game-page {
    display: grid !important;
    /* Левая панель: auto (занимает необходимое место), Центр (поле): квадрат, Правая панель: auto */
    grid-template-columns: auto 1fr auto !important;
    grid-template-rows: 1fr !important;
    grid-template-areas: "card-decks game-board players-panel" !important;
    gap: 1rem !important;
    align-items: stretch !important;
    justify-items: stretch !important;
    padding: 0.5rem !important;
    max-width: 100% !important;
    margin: 0 auto !important;
    min-height: 100vh !important;
    height: 100vh !important;
    max-height: 100vh !important; /* Фиксируем высоту */
    overflow: hidden !important;
    background: rgba(15, 23, 42, 0.95) !important; /* Единственная подложка */
    /* Предотвращаем изменение размеров после загрузки */
    box-sizing: border-box !important;
    position: relative !important;
  }
  
  /* Левая панель: карточки сделок и банк - GRID СЕТКА с фиксированными размерами */
  #card-decks-panel.card-decks-container {
    grid-area: card-decks !important;
    display: grid !important;
    grid-template-rows: auto 1fr !important; /* Банк фиксирован, карточки растягиваются */
    grid-template-columns: 1fr !important;
    grid-template-areas: 
      "bank"
      "cards" !important;
    visibility: visible !important;
    opacity: 1 !important;
    min-width: 280px !important; /* Минимальная ширина */
    max-width: 320px !important; /* Максимальная ширина */
    width: auto !important; /* Занимает необходимое место */
    min-height: 0 !important; /* Позволяет сжиматься в grid */
    height: 100% !important; /* На всю высоту */
    max-height: 100% !important;
    position: relative !important;
    transform: none !important;
    background: transparent !important; /* Убираем подложку */
    border-right: 2px solid rgba(148, 163, 184, 0.3) !important;
    padding: 1rem !important;
    box-sizing: border-box !important;
    z-index: 1 !important;
    overflow: hidden !important; /* Убираем прокрутку у контейнера */
    gap: 1rem !important; /* Отступ между банком и карточками */
    /* Предотвращаем изменение размеров после загрузки */
    contain: layout size !important; /* Изоляция layout */
  }
  
  /* Карточки сделок: компактные, чтобы все помещались */
  #card-decks-panel.card-decks-container .card-deck-card,
  #card-decks-panel .card-deck-card {
    flex: 0 0 auto !important; /* Не растягиваются */
    width: 100% !important;
    max-width: 100% !important; /* Не выходят за границы панели */
    min-width: 0 !important;
    padding: 0.5rem !important;
    box-sizing: border-box !important;
  }
  
  /* Заголовки/метрики в карточках — компактнее */
  #card-decks-panel .card-deck-title { 
    font-size: 0.95rem !important; 
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  #card-decks-panel .card-deck-subtitle { 
    font-size: 0.85rem !important; 
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #card-decks-panel .deck-metric { 
    transform: scale(0.95); 
    transform-origin: left center; 
  }
  
  /* Центральная область: игровое поле - фиксированные размеры для предотвращения сдвига */
  .game-board-container {
    grid-area: game-board !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    min-width: 0 !important; /* Позволяет сжиматься в grid */
    min-height: 0 !important;
    height: 100% !important; /* На всю высоту контейнера */
    max-height: 100% !important;
    width: 100% !important; /* Фиксируем ширину */
    max-width: 100% !important;
    padding: 0.5rem !important;
    box-sizing: border-box !important;
    overflow: hidden !important; /* Скрываем переполнение */
    position: relative !important;
    /* Предотвращаем изменение размеров после загрузки */
    flex: 1 1 auto !important;
  }
  
  /* Квадратная доска - фиксированные размеры для предотвращения сдвига */
  .game-page .board-wrapper {
    width: 100% !important;
    height: 100% !important;
    aspect-ratio: 1 / 1 !important; /* Всегда квадрат */
    margin: auto !important;
    max-width: 100% !important;
    max-height: 100% !important;
    min-width: 0 !important;
    min-height: 0 !important;
    box-sizing: border-box !important;
    position: relative !important;
    /* Предотвращаем изменение размеров после загрузки */
    flex: 0 0 auto !important; /* Не растягивается, использует aspect-ratio */
    overflow: hidden !important; /* Скрываем переполнение */
    /* Резервируем место для клеток до их загрузки */
    contain: layout size style paint !important; /* Полная изоляция */
  }
  
  /* Треки внутри доски - не влияют на размеры контейнера */
  .game-page .board-wrapper .track {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important; /* Клетки обрабатывают события */
  }
  
  /* Клетки - абсолютное позиционирование, не влияют на размеры */
  .game-page .board-wrapper .track-cell {
    position: absolute !important;
    /* Размеры задаются через CSS переменные или классы */
    box-sizing: border-box !important;
  }
  
  /* Правая панель: игроки - GRID СЕТКА с фиксированными размерами */
  .top-panel-container {
    grid-area: players-panel !important;
    display: grid !important;
    grid-template-rows: auto 1fr !important; /* Действия фиксированы, игроки растягиваются */
    grid-template-columns: 1fr !important;
    grid-template-areas: 
      "actions"
      "players" !important;
    visibility: visible !important;
    opacity: 1 !important;
    min-width: 320px !important; /* Минимальная ширина */
    max-width: 100% !important; /* На всю ширину */
    width: 100% !important; /* Занимает всю доступную ширину */
    min-height: 0 !important;
    height: 100% !important; /* На всю высоту */
    max-height: 100% !important;
    position: relative !important;
    transform: none !important;
    background: transparent !important; /* Убираем подложку */
    border-left: 2px solid rgba(148, 163, 184, 0.3) !important;
    padding: 0.5rem !important; /* Уменьшаем отступы */
    box-sizing: border-box !important;
    z-index: 1 !important;
    overflow: hidden !important; /* Убираем прокрутку у контейнера */
    gap: 0.5rem !important; /* Уменьшаем отступ между действиями и игроками */
    /* Предотвращаем изменение размеров после загрузки */
    contain: layout size !important; /* Изоляция layout */
  }
  
  /* Секция действий - GRID область */
  .top-panel-container .actions-section,
  #players-panel .actions-section {
    grid-area: actions !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    overflow: visible !important;
    background: transparent !important; /* Убираем подложку */
    padding: 0 !important; /* Убираем внутренние отступы */
  }
  
  /* Секция игроков - GRID область */
  .players-panel-container,
  #players-panel.top-panel-content {
    grid-area: players !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    height: 100% !important;
    min-height: 0 !important;
    overflow-y: auto !important; /* Прокрутка списка игроков */
    overflow-x: hidden !important;
    gap: 1rem !important;
    background: transparent !important; /* Убираем подложку */
    padding: 0 !important; /* Убираем внутренние отступы */
  }
  
  /* Скрываем секцию "Активный игрок" на десктопе */
  .active-player-widget,
  #players-panel .active-player-widget {
    display: none !important;
  }
  
  /* Секция действий на всю ширину */
  .actions-section,
  #players-panel .actions-section,
  .top-panel-content .actions-section {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  /* Кнопки действий на всю ширину */
  .actions-section .action-button,
  .actions-section button,
  .actions-section .btn {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Банк на десктопе: внутри левой панели (сверху) - GRID */
  #card-decks-panel #bank-section {
    grid-area: bank !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    border-bottom: 2px solid rgba(148, 163, 184, 0.3) !important;
    overflow: visible !important;
  }
  
  /* Внутренний контейнер для карточек - GRID область */
  #card-decks-panel .card-decks-inner {
    grid-area: cards !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 0.5rem !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    min-height: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* Карточки после банка - все вместе внизу */
  #card-decks-panel .card-deck-card {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    flex: 0 0 auto !important; /* Карточки не растягиваются */
  }
  
  #bank-preview-container {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
}

/* Mobile/tablet: вертикальная компоновка: игроки → поле → банк → колоды */
@media (max-width: 1024px) {
  /* Убираем все отступы у родительских контейнеров на мобиле */
  .app-content,
  #page-container,
  #game-page {
    padding: 0 !important;
    margin: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  #game-page,
  .game-page {
    display: flex !important;
    flex-direction: column !important;
    height: auto !important;
    min-height: 100vh;
    overflow-y: auto !important; /* скролл всей страницы, включая поле */
    grid-template-columns: 1fr !important;
    grid-template-areas: none !important;
    padding: 0 !important; /* Убираем отступы для полной ширины */
    gap: 0 !important; /* Убираем gap для полной ширины */
    margin: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    background: rgba(15, 23, 42, 0.95) !important; /* Единственная подложка для мобильной версии */
  }
  
  /* Внутренние клетки на 15% меньше на мобиле */
  :root {
    --inner-cell-size: clamp(56px, 5.6vmin, 70px) !important; /* Уменьшено на 15% (было 66px, 6.6vmin, 82px) */
  }
  
  /* Верхняя панель: только игроки (ход игроков) - на всю ширину, второй после поля */
  .top-panel-container {
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    max-height: none !important;
    order: 2 !important; /* Ход игроков - второй после поля */
    position: relative !important;
    transform: none !important;
    background: transparent !important; /* Убираем подложку */
    border-bottom: 2px solid rgba(148, 163, 184, 0.3) !important;
    border-left: none !important;
    border-right: none !important;
    padding: 1rem !important;
    margin: 0 !important;
    box-sizing: border-box !important;
    z-index: 0 !important;
    overflow: visible !important;
    flex-shrink: 0 !important; /* Не сжимается */
  }
  
  #players-panel.top-panel-content {
    display: flex !important;
    flex-direction: column !important; /* Вертикально на мобиле */
    width: 100% !important;
    min-width: 0 !important;
    height: auto !important;
    flex: 0 0 auto !important;
    overflow: visible !important;
    gap: 1rem !important;
    flex-wrap: nowrap !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Убеждаемся, что панель игроков видна на мобиле */
  #players-list-container {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Все секции внутри панели игроков на всю ширину */
  #players-panel > *,
  #players-list-container,
  .players-panel-container {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  /* Секции действий и игроков на всю ширину */
  .player-section,
  .actions-section,
  .players-section {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  /* Кнопки действий на всю ширину на мобиле */
  .action-button,
  .btn,
  button[class*="action"],
  .move-actions button,
  .status-actions button {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Контейнеры с кнопками на всю ширину */
  .move-actions,
  .status-actions,
  .game-controls {
    width: 100% !important;
    max-width: 100% !important;
    display: flex !important;
    flex-direction: column !important; /* Вертикально на мобиле */
    gap: 0.75rem !important;
    box-sizing: border-box !important;
  }
  
  /* Карточки игроков на всю ширину на мобиле */
  .players-panel-container .player-item,
  .player-item,
  .player-section,
  .player-card {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  .game-board-container {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    min-height: 50vh;
    order: 1 !important; /* Игровое поле - первое (вверху) */
    padding: 0 !important; /* Убираем отступы */
    margin: 0 !important;
    overflow: visible !important; /* не режем контент поля */
    flex-shrink: 0 !important; /* Не сжимается */
  }
  
  /* Банк на всю ширину, третий после поля и хода игроков */
  #card-decks-panel #bank-section {
    order: 3 !important; /* Банк - третий (после поля и хода игроков) */
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    flex: 0 0 auto !important;
    flex-shrink: 0 !important; /* Не сжимается */
    margin-top: 0 !important;
    padding: 1rem !important;
    box-sizing: border-box !important;
    border-top: 2px solid rgba(148, 163, 184, 0.3) !important;
    border-bottom: 2px solid rgba(148, 163, 184, 0.3) !important;
    overflow: visible !important;
    background: transparent !important; /* Убираем подложку */
  }
  
  /* Карточки после банка на мобиле - в самом низу */
  #card-decks-panel .card-deck-card {
    order: 4 !important; /* Карточки - четвертые (внизу) */
    flex-shrink: 0 !important; /* Не сжимается */
  }
  
  #bank-preview-container {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  
  #card-decks-panel.card-decks-container {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    max-height: none !important; /* Убираем внутренний скролл */
    order: 3 !important; /* Панель карточек (с банком внутри) - третий, после хода игроков */
    border-right: none !important;
    border-left: none !important;
    border-bottom: none !important;
    padding: 0 !important; /* Убираем padding, добавляем только для банка и карточек */
    position: relative !important;
    transform: none !important;
    flex-direction: column !important; /* Карточки в колонку */
    gap: 0 !important; /* Убираем gap, используем padding в секциях */
    flex-wrap: nowrap !important;
    overflow-y: visible !important; /* Нет доп. скролла */
    overflow-x: hidden !important;
    background: transparent !important; /* Убираем подложку */
    flex-shrink: 0 !important; /* Не сжимается */
  }
  
  /* Внутренний контейнер для карточек - отдельно от банка */
  #card-decks-panel .card-decks-inner {
    order: 4 !important; /* Карточки - четвертые (внизу) */
    padding: 1rem !important;
    padding-top: 0 !important; /* Убираем верхний отступ, т.к. банк уже имеет нижний border */
    display: flex !important;
    flex-direction: column !important;
    gap: 0.75rem !important;
  }
  
  /* Карточки напрямую в панели - тоже order 4 */
  #card-decks-panel > .card-deck-card {
    order: 4 !important; /* Карточки - четвертые (внизу) */
    padding: 1rem !important;
    padding-top: 0 !important; /* Убираем верхний отступ, т.к. банк уже имеет нижний border */
  }
  
  /* Карточки сделок на всю ширину */
  #card-decks-panel .card-deck-card,
  #card-decks-panel.card-decks-container .card-deck-card {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    flex: 0 0 auto !important;
  }
  
  /* Поле остаётся квадратом по ширине */
  .game-page .board-wrapper {
    width: 100% !important;
    max-width: 100vw !important;
    height: auto !important;
    aspect-ratio: 1 / 1 !important;
    margin: 0 auto !important;
    min-height: 320px !important; /* чёткий квадрат на маленьких экранах */
  }
}



