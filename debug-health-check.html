<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–æ–¥—É–ª–µ–π - Aura Money</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .module-check { 
            margin: 10px 0; 
            padding: 10px; 
            border-left: 4px solid #ccc; 
            background: #f8f9fa;
        }
        .module-check.good { border-color: #28a745; }
        .module-check.warning { border-color: #ffc107; }
        .module-check.error { border-color: #dc3545; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .logs {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }
        .progress {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–æ–¥—É–ª–µ–π</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π –∏ –≤—ã—è–≤–ª—è–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.</p>
        
        <div>
            <button onclick="runFullCheck()">üîç –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</button>
            <button onclick="runSafeCheck()">‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</button>
            <button onclick="clearLogs()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            <button onclick="testGameFlow()">üéÆ –¢–µ—Å—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞</button>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        
        <div id="status">–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ...</div>
        
        <div class="logs" id="logs">
–°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≥–æ—Ç–æ–≤–∞.
–ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞" –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∞.
        </div>

        <div id="results"></div>
    </div>

    <script>
        let checkResults = {};
        let logCount = 0;
        const MAX_LOGS = 100;

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚úÖ';
            
            logs.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤
            logCount++;
            if (logCount > MAX_LOGS) {
                const lines = logs.innerHTML.split('\n');
                logs.innerHTML = lines.slice(-MAX_LOGS).join('\n');
                logCount = MAX_LOGS;
            }
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã.\n';
            logCount = 0;
        }

        async function checkModule(moduleName, checkFn) {
            try {
                updateStatus(`–ü—Ä–æ–≤–µ—Ä–∫–∞ ${moduleName}...`);
                const result = await checkFn();
                checkResults[moduleName] = result;
                
                if (result.status === 'good') {
                    log(`${moduleName}: ${result.message}`, 'info');
                } else if (result.status === 'warning') {
                    log(`${moduleName}: ${result.message}`, 'warning');
                } else {
                    log(`${moduleName}: ${result.message}`, 'error');
                }
                
                return result;
            } catch (error) {
                const errorResult = {
                    status: 'error',
                    message: `–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`,
                    details: error.stack
                };
                checkResults[moduleName] = errorResult;
                log(`${moduleName}: ${errorResult.message}`, 'error');
                return errorResult;
            }
        }

        async function runSafeCheck() {
            log('üöÄ –ù–∞—á–∞–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏...');
            updateProgress(0);
            
            const checks = [
                ['WindowGlobals', checkWindowGlobals],
                ['BasicModules', checkBasicModules],
                ['Memory', checkMemoryUsage]
            ];
            
            for (let i = 0; i < checks.length; i++) {
                await checkModule(checks[i][0], checks[i][1]);
                updateProgress(((i + 1) / checks.length) * 100);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            displayResults();
            log('‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            updateStatus('–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        async function runFullCheck() {
            log('üöÄ –ù–∞—á–∞–ª–æ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã...');
            updateProgress(0);
            
            const checks = [
                ['WindowGlobals', checkWindowGlobals],
                ['BasicModules', checkBasicModules],
                ['GameStateManager', checkGameStateManager],
                ['EventSystem', checkEventSystem],
                ['Memory', checkMemoryUsage],
                ['Performance', checkPerformance],
                ['Dependencies', checkDependencies]
            ];
            
            for (let i = 0; i < checks.length; i++) {
                await checkModule(checks[i][0], checks[i][1]);
                updateProgress(((i + 1) / checks.length) * 100);
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏—è
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            displayResults();
            log('‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            updateStatus('–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        function checkWindowGlobals() {
            const requiredGlobals = [
                'EventBus', 'GameStateManager', 'GameState', 'App',
                'Router', 'Logger', 'ErrorHandler', 'PerformanceMonitor'
            ];
            
            const missing = requiredGlobals.filter(name => !window[name]);
            const available = requiredGlobals.filter(name => window[name]);
            
            if (missing.length === 0) {
                return {
                    status: 'good',
                    message: `–í—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã (${available.length})`
                };
            } else if (missing.length <= 2) {
                return {
                    status: 'warning',
                    message: `–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç: ${missing.join(', ')}`
                };
            } else {
                return {
                    status: 'error',
                    message: `–ö—Ä–∏—Ç–∏—á–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç: ${missing.join(', ')}`
                };
            }
        }

        function checkBasicModules() {
            let errorCount = 0;
            let warningCount = 0;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º app
            if (window.app) {
                if (typeof window.app.init === 'function') {
                    // OK
                } else {
                    errorCount++;
                }
            } else {
                errorCount++;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º logger
            if (window.logger) {
                if (typeof window.logger.info === 'function') {
                    // OK
                } else {
                    warningCount++;
                }
            } else {
                warningCount++;
            }
            
            if (errorCount > 0) {
                return {
                    status: 'error',
                    message: `–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏: ${errorCount}, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${warningCount}`
                };
            } else if (warningCount > 0) {
                return {
                    status: 'warning',
                    message: `–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${warningCount}`
                };
            } else {
                return {
                    status: 'good',
                    message: '–í—Å–µ –±–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'
                };
            }
        }

        function checkGameStateManager() {
            if (!window.GameStateManager) {
                return {
                    status: 'error',
                    message: 'GameStateManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'
                };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
            let instanceCount = 0;
            if (window.app?.getModule?.('gameStateManager')) instanceCount++;
            if (window.app?.services?.has?.('gameStateManager')) instanceCount++;
            
            if (instanceCount === 0) {
                return {
                    status: 'warning',
                    message: 'GameStateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'
                };
            } else if (instanceCount === 1) {
                return {
                    status: 'good',
                    message: 'GameStateManager –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (1 —ç–∫–∑–µ–º–ø–ª—è—Ä)'
                };
            } else {
                return {
                    status: 'error',
                    message: `–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${instanceCount} —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ GameStateManager!`
                };
            }
        }

        function checkEventSystem() {
            if (!window.EventBus) {
                return {
                    status: 'error',
                    message: 'EventBus –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'
                };
            }
            
            const eventBus = window.app?.getEventBus?.();
            if (!eventBus) {
                return {
                    status: 'warning',
                    message: 'EventBus –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ App'
                };
            }
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
            try {
                let testPassed = false;
                eventBus.on('health-check', () => { testPassed = true; });
                eventBus.emit('health-check');
                
                if (testPassed) {
                    return {
                        status: 'good',
                        message: 'EventBus —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'
                    };
                } else {
                    return {
                        status: 'warning',
                        message: 'EventBus –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è'
                    };
                }
            } catch (error) {
                return {
                    status: 'error',
                    message: `–û—à–∏–±–∫–∞ EventBus: ${error.message}`
                };
            }
        }

        function checkMemoryUsage() {
            if (!performance.memory) {
                return {
                    status: 'warning',
                    message: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'
                };
            }
            
            const used = performance.memory.usedJSHeapSize;
            const limit = performance.memory.jsHeapSizeLimit;
            const usagePercent = (used / limit) * 100;
            
            if (usagePercent < 50) {
                return {
                    status: 'good',
                    message: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: ${usagePercent.toFixed(1)}% (${Math.round(used/1024/1024)}MB)`
                };
            } else if (usagePercent < 80) {
                return {
                    status: 'warning',
                    message: `–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: ${usagePercent.toFixed(1)}% (${Math.round(used/1024/1024)}MB)`
                };
            } else {
                return {
                    status: 'error',
                    message: `–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: ${usagePercent.toFixed(1)}% (${Math.round(used/1024/1024)}MB)`
                };
            }
        }

        function checkPerformance() {
            const start = performance.now();
            
            // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            let sum = 0;
            for (let i = 0; i < 100000; i++) {
                sum += Math.random();
            }
            
            const end = performance.now();
            const duration = end - start;
            
            if (duration < 10) {
                return {
                    status: 'good',
                    message: `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–Ω–∞—è: ${duration.toFixed(2)}ms`
                };
            } else if (duration < 50) {
                return {
                    status: 'warning',
                    message: `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–∞—è: ${duration.toFixed(2)}ms`
                };
            } else {
                return {
                    status: 'error',
                    message: `–ù–ò–ó–ö–ê–Ø –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration.toFixed(2)}ms`
                };
            }
        }

        function checkDependencies() {
            const dependencies = [
                { name: 'fetch', check: () => typeof fetch === 'function' },
                { name: 'Promise', check: () => typeof Promise === 'function' },
                { name: 'localStorage', check: () => typeof localStorage === 'object' },
                { name: 'sessionStorage', check: () => typeof sessionStorage === 'object' },
                { name: 'WebSocket', check: () => typeof WebSocket === 'function' }
            ];
            
            const missing = dependencies.filter(dep => !dep.check()).map(dep => dep.name);
            const available = dependencies.filter(dep => dep.check()).map(dep => dep.name);
            
            if (missing.length === 0) {
                return {
                    status: 'good',
                    message: `–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã (${available.length})`
                };
            } else {
                return {
                    status: 'warning',
                    message: `–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: ${missing.join(', ')}`
                };
            }
        }

        function displayResults() {
            const resultsDiv = document.getElementById('results');
            let html = '<h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>';
            
            for (const [moduleName, result] of Object.entries(checkResults)) {
                const statusClass = result.status;
                html += `
                    <div class="module-check ${statusClass}">
                        <strong>${moduleName}</strong>: ${result.message}
                    </div>
                `;
            }
            
            // –°–≤–æ–¥–∫–∞
            const good = Object.values(checkResults).filter(r => r.status === 'good').length;
            const warnings = Object.values(checkResults).filter(r => r.status === 'warning').length;
            const errors = Object.values(checkResults).filter(r => r.status === 'error').length;
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                    <h4>üìà –°–≤–æ–¥–∫–∞</h4>
                    <div class="status-good">‚úÖ –ò—Å–ø—Ä–∞–≤–Ω–æ: ${good}</div>
                    <div class="status-warning">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${warnings}</div>
                    <div class="status-error">‚ùå –û—à–∏–±–∫–∏: ${errors}</div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        async function testGameFlow() {
            log('üéÆ –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é App
                if (window.app) {
                    log('App –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
                    
                    if (typeof window.app.init === 'function') {
                        log('–ú–µ—Ç–æ–¥ init –¥–æ—Å—Ç—É–ø–µ–Ω');
                        
                        // –û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                        const router = window.app.getRouter?.();
                        if (router) {
                            log('Router –¥–æ—Å—Ç—É–ø–µ–Ω');
                        } else {
                            log('Router –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º GameStateManager
                        const gsm = window.app.getGameStateManager?.();
                        if (gsm) {
                            log('GameStateManager –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –≥–æ—Ç–æ–≤');
                        } else {
                            log('GameStateManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                        }
                        
                    } else {
                        log('–ú–µ—Ç–æ–¥ App.init –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    }
                } else {
                    log('App –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ${error.message}`, 'error');
            }
            
            log('üèÅ –¢–µ—Å—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üåü –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                log('üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ "–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞" –¥–ª—è –±–∞–∑–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏');
            }, 1000);
        });
    </script>
</body>
</html>

