# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: 429 TOO MANY REQUESTS

## üî• –ü–†–û–ë–õ–ï–ú–ê
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ **3320+ –æ—à–∏–±–æ–∫ HTTP 429** –∫ API endpoint `/api/rooms/{roomId}/game-state`, —á—Ç–æ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ rate limiting.

## üîç –ê–ù–ê–õ–ò–ó –ò–°–¢–û–ß–ù–ò–ö–û–í –ü–†–û–ë–õ–ï–ú–´

–ù–∞–π–¥–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
1. **PlayersPanel.js** - `forceLoadPlayers()`, `preloadGameData()`, `_fetchPlayersInBackground()`
2. **TurnSyncService.js** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
3. **PushClient.js** - polling –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥  
4. **BankPreview.js** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
5. **BankModule/BankModuleServer** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. PlayersPanel.js - Rate Limiting
**–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
```javascript
// Rate limiting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è 429 –æ—à–∏–±–æ–∫
this._lastApiRequestTime = 0;
this._minRequestInterval = 3000; // –ú–∏–Ω–∏–º—É–º 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º:
const now = Date.now();
if (now - this._lastApiRequestTime < this._minRequestInterval) {
    console.log('üö´ PlayersPanel: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏–∑-–∑–∞ rate limiting');
    return;
}
```

**–£–≤–µ–ª–∏—á–µ–Ω –∫—ç—à:**
- `_cacheTimeout`: 2000ms ‚Üí 5000ms (—É–≤–µ–ª–∏—á–∏–ª–∏ –∫—ç—à –¥–æ 5 —Å–µ–∫—É–Ω–¥)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–∞—Ö:**
- `_fetchPlayersInBackground()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ rate limiting
- `_fetchPlayersFromAPI()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ rate limiting  
- `preloadGameData()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ rate limiting

### 2. TurnSyncService.js - –£–≤–µ–ª–∏—á–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª
```javascript
// –ë–´–õ–û: 5000ms (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
this.syncInterval = setInterval(() => {
    this.syncGameState();
}, 5000);

// –°–¢–ê–õ–û: 10000ms (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
this.syncInterval = setInterval(() => {
    this.syncGameState();
}, 10000);
```

### 3. PushClient.js - –£–≤–µ–ª–∏—á–µ–Ω polling –∏–Ω—Ç–µ—Ä–≤–∞–ª
```javascript
// –ë–´–õ–û: 5000ms
this.pollingIntervalMs = 5000; // 5 —Å–µ–∫—É–Ω–¥

// –°–¢–ê–õ–û: 15000ms  
this.pollingIntervalMs = 15000; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 15 —Å–µ–∫—É–Ω–¥
```

### 4. CommonUtils.js - –ì–ª–æ–±–∞–ª—å–Ω—ã–π Rate Limiter
**–î–æ–±–∞–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:**
```javascript
static rateLimiter = {
    _lastRequestTime: 0,
    _minInterval: 2000, // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª 2 —Å–µ–∫—É–Ω–¥—ã
    
    canMakeRequest() {
        const now = Date.now();
        if (now - this._lastRequestTime >= this._minInterval) {
            this._lastRequestTime = now;
            return true;
        }
        return false;
    }
};

static canMakeApiRequest(minInterval = 2000) {
    return this.rateLimiter.canMakeRequest();
}
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:
- **TurnSyncService**: —Å –∫–∞–∂–¥—ã—Ö 5 —Å–µ–∫ ‚Üí –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫ (**50% —Å–Ω–∏–∂–µ–Ω–∏–µ**)
- **PushClient**: —Å –∫–∞–∂–¥—ã—Ö 5 —Å–µ–∫ ‚Üí –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫ (**66% —Å–Ω–∏–∂–µ–Ω–∏–µ**)
- **PlayersPanel**: rate limiting 3 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–ö—ç—à**: —É–≤–µ–ª–∏—á–µ–Ω —Å 2 –¥–æ 5 —Å–µ–∫—É–Ω–¥ (**150% —É–≤–µ–ª–∏—á–µ–Ω–∏–µ**)

### –û–∂–∏–¥–∞–µ–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏:
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤**: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ **60-70%**
- **429 –æ—à–∏–±–∫–∏**: –¥–æ–ª–∂–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–Ω—É—Ç—å
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞**: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

## üõ°Ô∏è –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ï–†–´ –ó–ê–©–ò–¢–´

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏** - –≤—Å–µ –º–æ–¥—É–ª–∏ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç rate limiting
2. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** - —Å–Ω–∏–∂–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ polling
3. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É
4. **Graceful handling** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 429 –æ—à–∏–±–æ–∫
5. **AbortController** - –æ—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üéØ –ú–û–ù–ò–¢–û–†–ò–ù–ì

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ 429 –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ê–¥–µ–∫–≤–∞—Ç–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ù–ï–î–†–ï–ù–´  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üö® –í–´–°–û–ö–ò–ô - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã  
**–í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ



















