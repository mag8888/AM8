<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç BalanceManager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #f8fafc;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .balance-display {
            background: #374151;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .log {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç BalanceManager</h1>
        
        <div class="test-section">
            <h3>üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏</h3>
            <button class="test-button" onclick="testUpdateBalance()">–û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button class="test-button" onclick="testGetBalance()">–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button class="test-button" onclick="testRefreshFromGameState()">–û–±–Ω–æ–≤–∏—Ç—å –∏–∑ GameState</button>
            <button class="test-button" onclick="testGetAllBalances()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã</button>
            <button class="test-button" onclick="testClearBalances()">–û—á–∏—Å—Ç–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã</button>
            
            <div class="balance-display" id="balance-display">
                –ë–∞–ª–∞–Ω—Å—ã: {}
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <button class="test-button" onclick="testGetStats()">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <button class="test-button" onclick="testHasEnoughMoney()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤</button>
            <button class="test-button" onclick="testGetFormattedBalance()">–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å</button>
            
            <div class="balance-display" id="stats-display">
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π</h3>
            <button class="test-button" onclick="testDebounce()">–¢–µ—Å—Ç Debounce</button>
            <button class="test-button" onclick="testDataFreshness()">–¢–µ—Å—Ç —Å–≤–µ–∂–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="test-button" onclick="testPerformance()">–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
        </div>
        
        <div class="test-section">
            <h3>üìù –õ–æ–≥–∏</h3>
            <div class="log" id="log"></div>
            <button class="test-button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º BalanceManager -->
    <script src="assets/js/modules/game/BalanceManager.js"></script>
    
    <script>
        // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä BalanceManager
        const balanceManager = new BalanceManager();
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logElement = document.getElementById('log');
            if (logElement) {
                logElement.innerHTML += args.join(' ') + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }
        };
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testPlayers = [
            { id: 'player1', username: '–ò–≥—Ä–æ–∫ 1', cash: 1000 },
            { id: 'player2', username: '–ò–≥—Ä–æ–∫ 2', cash: 2500 },
            { id: 'player3', username: '–ò–≥—Ä–æ–∫ 3', cash: 750 },
            { id: 'player4', username: '–ò–≥—Ä–æ–∫ 4', cash: 3200 }
        ];
        
        function testUpdateBalance() {
            const userId = 'player1';
            const newBalance = Math.floor(Math.random() * 5000);
            balanceManager.updateBalance(userId, newBalance, 'manual');
            updateBalanceDisplay();
        }
        
        function testGetBalance() {
            const userId = 'player1';
            const balance = balanceManager.getBalance(userId);
            console.log(`üí∞ –ë–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ ${userId}: $${balance}`);
        }
        
        function testRefreshFromGameState() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã
            testPlayers.forEach(player => {
                player.cash = Math.floor(Math.random() * 5000);
            });
            balanceManager.refreshFromGameState(testPlayers);
            updateBalanceDisplay();
        }
        
        function testGetAllBalances() {
            const allBalances = balanceManager.getAllBalances();
            console.log('üìä –í—Å–µ –±–∞–ª–∞–Ω—Å—ã:', allBalances);
            updateBalanceDisplay();
        }
        
        function testClearBalances() {
            balanceManager.clearBalances();
            console.log('üßπ –í—Å–µ –±–∞–ª–∞–Ω—Å—ã –æ—á–∏—â–µ–Ω—ã');
            updateBalanceDisplay();
        }
        
        function testGetStats() {
            const stats = balanceManager.getStats();
            document.getElementById('stats-display').textContent = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${JSON.stringify(stats, null, 2)}`;
            console.log('üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', stats);
        }
        
        function testHasEnoughMoney() {
            const userId = 'player1';
            const requiredAmount = 1500;
            const hasEnough = balanceManager.hasEnoughMoney(userId, requiredAmount);
            console.log(`üí≥ –£ –∏–≥—Ä–æ–∫–∞ ${userId} ${hasEnough ? '–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ' : '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ'} —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—É–º–º—ã $${requiredAmount}`);
        }
        
        function testGetFormattedBalance() {
            const userId = 'player1';
            const formattedBalance = balanceManager.getFormattedBalance(userId);
            console.log(`üíµ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ ${userId}: ${formattedBalance}`);
        }
        
        function testDebounce() {
            console.log('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ debounce (5 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥)...');
            for (let i = 0; i < 5; i++) {
                balanceManager.refreshFromGameState(testPlayers);
            }
            console.log('‚úÖ Debounce —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
        }
        
        function testDataFreshness() {
            const userId = 'player1';
            balanceManager.updateBalance(userId, 1000, 'test');
            
            console.log('‚è∞ –î–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ:', balanceManager.isDataFresh(userId));
            
            // –ñ–¥–µ–º 4 —Å–µ–∫—É–Ω–¥—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
            setTimeout(() => {
                console.log('‚è∞ –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏:', !balanceManager.isDataFresh(userId));
            }, 4000);
        }
        
        function testPerformance() {
            console.log('‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...');
            const startTime = performance.now();
            
            // –°–æ–∑–¥–∞–µ–º 100 –∏–≥—Ä–æ–∫–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö –±–∞–ª–∞–Ω—Å—ã
            const players = [];
            for (let i = 0; i < 100; i++) {
                players.push({
                    id: `perf_player_${i}`,
                    username: `–ò–≥—Ä–æ–∫ ${i}`,
                    cash: Math.floor(Math.random() * 10000)
                });
            }
            
            balanceManager.refreshFromGameState(players);
            
            const endTime = performance.now();
            console.log(`‚ö° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 100 –±–∞–ª–∞–Ω—Å–æ–≤ –∑–∞–Ω—è–ª–æ: ${(endTime - startTime).toFixed(2)}ms`);
        }
        
        function updateBalanceDisplay() {
            const allBalances = balanceManager.getAllBalances();
            document.getElementById('balance-display').textContent = 
                `–ë–∞–ª–∞–Ω—Å—ã: ${JSON.stringify(allBalances, null, 2)}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        console.log('üöÄ BalanceManager —Ç–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        balanceManager.refreshFromGameState(testPlayers);
        updateBalanceDisplay();
    </script>
</body>
</html>
