# üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É —Å–∏—Å—Ç–µ–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ö–æ–¥–∞

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

> **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: Backup –∏ refactored —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã. –í—Å–µ —Å—Å—ã–ª–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è current API.

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
- –ü–µ—Ä–µ–¥–∞—á–∞ —Ö–æ–¥–∞ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞
- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - PlayersPanel –∏ TurnController –æ–±–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –∏–≥—Ä–æ–∫–æ–≤
2. **–ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. üèóÔ∏è –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π GameStateManager

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
**–†–µ—à–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

```javascript
// assets/js/modules/GameStateManager.js
class GameStateManager {
    constructor() {
        this.players = [];
        this.activePlayer = null;
        this.gameState = {
            canRoll: false,
            canMove: false,
            canEndTurn: false,
            lastDiceResult: null
        };
        this.roomId = null;
        this.listeners = new Map();
    }
    
    // –ï–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    updateFromServer(serverState) {
        this.players = serverState.players || this.players;
        this.activePlayer = serverState.activePlayer || this.activePlayer;
        this.gameState = { ...this.gameState, ...serverState };
        this.notifyListeners('state:updated', this.getState());
    }
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    notifyListeners(event, data) {
        if (this.listeners.has(event)) {
            this.listeners.get(event).forEach(callback => callback(data));
        }
    }
    
    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    on(event, callback) {
        if (!this.listeners.has(event)) {
            this.listeners.set(event, new Set());
        }
        this.listeners.get(event).add(callback);
    }
}
```

### 2. üîÑ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ-—Å–≤–æ–µ–º—É
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ GameStateManager

```javascript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PlayersPanel
gameStateManager.on('state:updated', (state) => {
    playersPanel.updatePlayers(state.players, state.activePlayer);
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TurnController
gameStateManager.on('state:updated', (state) => {
    turnController.updateUI(state);
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ö–æ–¥–∞
gameStateManager.on('turn:changed', (data) => {
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    this.updateAllComponents();
});
```

### 3. üì° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

**–ü—Ä–æ–±–ª–µ–º–∞**: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ push-—Å–æ–±—ã—Ç–∏–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```javascript
// assets/js/modules/game/PushClient.js - –¢–ï–ö–£–©–ò–ô API
class PushClient {
    constructor({ gameState, eventBus }) {
        this.gameState = gameState;
        this.eventBus = eventBus;
        this.clientId = null;
        this.isRegistered = false;
        this.pollingIntervalMs = 5000; // 5 —Å–µ–∫—É–Ω–¥ –∏–Ω—Ç–µ—Ä–≤–∞–ª
        this.init();
    }
    
    async init() {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–ª–∏–µ–Ω—Ç–∞
        this.clientId = this.generateClientId();
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        await this.register();
        // –ó–∞–ø—É—Å–∫–∞–µ–º polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        this.startPolling();
    }
    
    handlePushEvent(data) {
        switch (data.type) {
            case 'turn_changed':
                this.gameState.updateFromServer(data.data);
                break;
            case 'player_joined':
                this.gameState.addPlayer(data.data.player);
                break;
            case 'dice_rolled':
                this.gameState.updateDiceResult(data.data);
                break;
        }
    }
}
```

### 4. üé® –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É —Å—Ç–∞—Ç—É—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä–æ–∫–∞
**–†–µ—à–µ–Ω–∏–µ**: –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

```javascript
// assets/js/utils/PlayerStatusUtils.js
class PlayerStatusUtils {
    static getPlayerStatus(player, activePlayer, isCurrentUser = false) {
        if (activePlayer && activePlayer.id === player.id) {
            return isCurrentUser ? 'üéØ –í–∞—à —Ö–æ–¥' : 'üéØ –•–æ–¥ –∏–≥—Ä–æ–∫–∞';
        }
        
        if (player.isReady) {
            return '‚úÖ –ì–æ—Ç–æ–≤';
        }
        
        return '‚è≥ –ì–æ—Ç–æ–≤–∏—Ç—Å—è';
    }
    
    static getPlayerDisplayName(player) {
        return player.username || player.name || `–ò–≥—Ä–æ–∫ ${player.id}`;
    }
    
    static getPlayerToken(player) {
        const tokenIcons = {
            'lion': 'ü¶Å', 'eagle': 'ü¶Ö', 'fox': 'ü¶ä', 'bear': 'üêª',
            'tiger': 'üêÖ', 'wolf': 'üê∫', 'elephant': 'üêò', 'shark': 'ü¶à',
            'owl': 'ü¶â', 'dolphin': 'üê¨'
        };
        return tokenIcons[player.token] || 'üéØ';
    }
}
```

### 5. üßπ –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: PlayersPanel –∏ TurnController –¥—É–±–ª–∏—Ä—É—é—Ç –ª–æ–≥–∏–∫—É
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç PlayerList

```javascript
// assets/js/components/PlayerList.js
class PlayerList {
    constructor(containerId, options = {}) {
        this.container = document.getElementById(containerId);
        this.options = {
            showBalance: true,
            showStatus: true,
            showToken: true,
            ...options
        };
    }
    
    updatePlayers(players, activePlayer, currentUserId = null) {
        if (!this.container) return;
        
        this.container.innerHTML = players.map(player => {
            const isActive = activePlayer && player.id === activePlayer.id;
            const isCurrentUser = currentUserId && player.id === currentUserId;
            
            return this.renderPlayerItem(player, isActive, isCurrentUser);
        }).join('');
    }
    
    renderPlayerItem(player, isActive, isCurrentUser) {
        const status = PlayerStatusUtils.getPlayerStatus(player, activePlayer, isCurrentUser);
        const token = PlayerStatusUtils.getPlayerToken(player);
        const name = PlayerStatusUtils.getPlayerDisplayName(player);
        
        return `
            <div class="player-item ${isActive ? 'active' : ''}">
                <div class="player-avatar">${token}</div>
                <div class="player-info">
                    <div class="player-name">${name}</div>
                    ${this.options.showStatus ? `<div class="player-status">${status}</div>` : ''}
                    ${this.options.showBalance ? `<div class="player-balance">$${player.money || 0}</div>` : ''}
                </div>
            </div>
        `;
    }
}
```

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ GameStateManager
- [ ] –°–æ–∑–¥–∞—Ç—å `GameStateManager.js`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ PlayersPanel
- [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É
- [ ] –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ GameStateManager
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PlayerStatusUtils

### –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ TurnController
- [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É
- [ ] –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ GameStateManager
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π PlayerList

### –≠—Ç–∞–ø 4: Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å PushClient
- [ ] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å push-—Å–æ–±—ã—Ç–∏—è
- [ ] –û–±–Ω–æ–≤–ª—è—Ç—å GameStateManager

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
3. **Real-time** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:
- –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ < 100ms
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ UI
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ 60%
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ 80%

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- EventTarget API –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- EventSource –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- Graceful degradation –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º push

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- Debounce –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DOM –æ–ø–µ—Ä–∞—Ü–∏–π

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: $(date)*
*–í–µ—Ä—Å–∏—è: 1.0*
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏*
