<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Ready Button</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .debug-panel {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .btn {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-success { background: #28a745; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .debug-info {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>üîß Debug Ready Button</h1>
    
    <div class="debug-panel">
        <h3>–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏</h3>
        <button class="btn btn-success btn-large" id="ready-button" disabled>
            ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!
        </button>
        <button class="btn btn-secondary" id="debug-btn">
            üîç –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        </button>
    </div>
    
    <div class="debug-panel">
        <h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div id="debug-info" class="debug-info">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"
        </div>
    </div>
    
    <div class="debug-panel">
        <h3>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <button class="btn btn-secondary" id="set-dream-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—á—Ç—É</button>
        <button class="btn btn-secondary" id="set-token-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏—à–∫—É</button>
        <button class="btn btn-secondary" id="clear-data-btn">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <script>
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ room.js
        let dreamData = {};
        let selectedToken = null;
        let currentUser = { id: 'test-user', username: 'test' };
        let currentRoom = {
            players: [
                { userId: 'test-user', username: 'test', isReady: false }
            ]
        };

        const readyButton = document.getElementById('ready-button');
        const debugInfo = document.getElementById('debug-info');
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–∫–æ–ø–∏—è –∏–∑ room.js)
        function updateReadyStatus() {
            const isDreamSelected = dreamData && dreamData.id && dreamData.title;
            const isDreamComplete = isDreamSelected && dreamData.description && dreamData.cost > 0;
            const isTokenSelected = selectedToken !== null && selectedToken !== 'null';
            const canBeReady = isDreamComplete && isTokenSelected;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            const currentPlayer = currentRoom ? currentRoom.players.find(p => {
                const matches = p.userId === currentUser?.id || p.username === currentUser?.username;
                if (matches) {
                    console.log('üîç Debug: –ù–∞–π–¥–µ–Ω —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫:', {
                        player: p,
                        currentUser: currentUser,
                        matchType: p.userId === currentUser?.id ? 'userId' : 'username',
                        playerIsReady: p.isReady,
                        playerIsReadyType: typeof p.isReady
                    });
                }
                return matches;
            }) : null;
            
            const isCurrentlyReady = currentPlayer ? Boolean(currentPlayer.isReady) : false;
            const actualReadyState = currentPlayer !== null && canBeReady ? isCurrentlyReady : false;
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–æ–∂–Ω–æ –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º
            readyButton.disabled = !canBeReady;
            
            console.log('üîç Debug: –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:', {
                isDreamComplete,
                isTokenSelected,
                canBeReady,
                isCurrentlyReady,
                actualReadyState,
                currentPlayer: currentPlayer ? { 
                    name: currentPlayer.name, 
                    username: currentPlayer.username,
                    isReady: currentPlayer.isReady,
                    userId: currentPlayer.userId,
                    id: currentPlayer.id
                } : null,
                currentUser: currentUser ? { 
                    id: currentUser.id, 
                    username: currentUser.username,
                    userId: currentUser.userId
                } : null,
                roomPlayers: currentRoom ? currentRoom.players.map(p => ({
                    name: p.name,
                    username: p.username,
                    isReady: p.isReady,
                    userId: p.userId,
                    id: p.id
                })) : [],
                disabled: readyButton.disabled,
                buttonText: readyButton.innerHTML,
                buttonClass: readyButton.className
            });
            
            if (canBeReady === true) {
                if (actualReadyState === true) {
                    readyButton.innerHTML = '‚ùå –ù–µ –≥–æ—Ç–æ–≤';
                    readyButton.className = 'btn btn-secondary btn-large';
                } else {
                    readyButton.innerHTML = '‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!';
                    readyButton.className = 'btn btn-success btn-large';
                }
            } else {
                readyButton.innerHTML = '‚è≥ –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—á—Ç—É –∏ —Ñ–∏—à–∫—É';
                readyButton.className = 'btn btn-secondary btn-large';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        readyButton.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            console.log('üéØ Debug: –ö–õ–ò–ö –ü–û –ö–ù–û–ü–ö–ï –ì–û–¢–û–í–ù–û–°–¢–ò!');
            
            if (readyButton.disabled) {
                console.warn('‚ö†Ô∏è Debug: –ö–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞');
                return;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const currentPlayer = currentRoom.players.find(p => p.userId === currentUser.id || p.username === currentUser.username);
            if (currentPlayer) {
                currentPlayer.isReady = !currentPlayer.isReady;
                console.log('üîÑ Debug: –°–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞:', currentPlayer.isReady);
                updateReadyStatus();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫
        document.getElementById('set-dream-btn').addEventListener('click', () => {
            dreamData = {
                id: 'test-dream',
                title: '–¢–µ—Å—Ç–æ–≤–∞—è –º–µ—á—Ç–∞',
                description: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –º–µ—á—Ç—ã',
                cost: 100000
            };
            console.log('‚úÖ Debug: –ú–µ—á—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', dreamData);
            updateReadyStatus();
        });
        
        document.getElementById('set-token-btn').addEventListener('click', () => {
            selectedToken = 'ü¶Å';
            console.log('‚úÖ Debug: –§–∏—à–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', selectedToken);
            updateReadyStatus();
        });
        
        document.getElementById('clear-data-btn').addEventListener('click', () => {
            dreamData = {};
            selectedToken = null;
            console.log('üóëÔ∏è Debug: –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            updateReadyStatus();
        });
        
        document.getElementById('debug-btn').addEventListener('click', () => {
            const info = {
                dreamData,
                selectedToken,
                currentUser,
                currentRoom,
                buttonDisabled: readyButton.disabled,
                buttonText: readyButton.innerHTML,
                buttonClass: readyButton.className
            };
            debugInfo.textContent = JSON.stringify(info, null, 2);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateReadyStatus();
    </script>
</body>
</html>
