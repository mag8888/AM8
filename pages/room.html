<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–º–Ω–∞—Ç–∞ - Aura Money</title>
    <link rel="icon" type="image/svg+xml" href="../assets/images/favicon.svg">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/images/favicon.svg">
    <link rel="stylesheet" href="../assets/css/main.css?v=1">
    <link rel="stylesheet" href="../assets/css/room.css?v=1">
    <link rel="stylesheet" href="../assets/css/modals.css">
    <link rel="stylesheet" href="../assets/css/fixes.css">
    <style>
        @keyframes skeleton-loading {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton-text {
            border-radius: 4px;
            display: inline-block;
        }
        .skeleton-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        .skeleton-player {
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="app-navigation">
        <div class="nav-container">
            <a href="../" class="nav-logo">
                <img src="../assets/images/logo.svg?v=2" alt="Aura Money" class="logo-img">
            </a>
            
            <div class="nav-menu">
                <a href="../" class="nav-link" data-route="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="rooms.html" class="nav-link" data-route="/rooms">–ö–æ–º–Ω–∞—Ç—ã</a>
                <a href="../auth/" class="nav-link" data-route="/auth">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>
            </div>
            
            <div class="nav-user" id="nav-user">
                <div class="user-info" id="user-info" style="display: none;">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <span id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                </div>
                <button class="nav-button" id="auth-button">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="app-content">
        <div class="room-container">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–Ω–∞—Ç—ã -->
            <header class="room-header">
                <div class="header-content">
                    <div class="header-left">
                        <h1 class="room-title" id="room-title">üè† –ö–æ–º–Ω–∞—Ç–∞</h1>
                        <p class="room-subtitle" id="room-subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ—é –º–µ—á—Ç—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏—à–∫—É</p>
                        <p class="username-display" id="room-username-display" style="color: #10b981; font-weight: 600; margin-top: 0.5rem;">–ò–≥—Ä–æ–∫: <span id="room-current-username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span></p>
                    </div>
                    <div class="header-right">
                        <div class="user-info" id="room-user-info">
                            <div class="user-avatar" id="room-user-avatar">U</div>
                            <span class="user-name" id="room-user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <div class="room-content">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ -->
                <div class="room-sidebar">
                    <div class="room-info-card">
                        <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ</h3>
                        <div class="info-item">
                            <span class="info-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</span>
                            <span class="info-value" id="room-name">
                                <div class="skeleton-text" style="width: 120px; height: 16px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;"></div>
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°–æ–∑–¥–∞—Ç–µ–ª—å:</span>
                            <span class="info-value" id="room-creator">
                                <div class="skeleton-text" style="width: 80px; height: 16px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;"></div>
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–ò–≥—Ä–æ–∫–∏:</span>
                            <span class="info-value" id="room-players">0/4</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="info-value" id="room-status">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                        </div>
                    </div>

                    <div class="players-card">
                        <h3>üë• –ò–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ</h3>
                        <div class="players-list" id="players-list">
                            <div class="player-item skeleton-player">
                                <div class="player-avatar skeleton-avatar"></div>
                                <div class="player-info">
                                    <div class="player-name">
                                        <div class="skeleton-text" style="width: 100px; height: 16px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;"></div>
                                    </div>
                                    <div class="player-status">
                                        <div class="skeleton-text" style="width: 60px; height: 14px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="actions-card">
                        <h3>üéÆ –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <button class="btn btn-secondary" id="back-to-rooms">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–æ–º–Ω–∞—Ç–∞–º
                        </button>
                        <button class="btn btn-success btn-large" id="ready-button" disabled>
                            ‚úÖ –Ø –≥–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ!
                        </button>
                        <button class="btn btn-primary" id="start-game" disabled>
                            üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                        </button>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä–æ–∫–∞ -->
                <div class="room-main">
                    <!-- –í—ã–±–æ—Ä –º–µ—á—Ç—ã -->
                    <div class="dream-section">
                        <div class="section-header">
                            <h2>üí≠ –ú–æ—è –º–µ—á—Ç–∞</h2>
                            <p>–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å</p>
                        </div>
                        
                        <div class="dream-form">
                            <div class="form-group">
                                <label for="dream-select">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—á—Ç—É</label>
                                <select id="dream-select">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –º–µ—á—Ç—É...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="dream-description">–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—á—Ç—ã</label>
                                <textarea 
                                    id="dream-description" 
                                    placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–≤–æ–µ–π –º–µ—á—Ç—ã..."
                                    rows="3"
                                    maxlength="500"
                                    readonly
                                ></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="dream-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å –º–µ—á—Ç—ã</label>
                                <input 
                                    type="number" 
                                    id="dream-cost" 
                                    placeholder="0"
                                    min="0"
                                    step="1000"
                                    readonly
                                >
                                <span class="currency">$</span>
                            </div>
                        </div>
                    </div>

                    <!-- –í—ã–±–æ—Ä —Ñ–∏—à–∫–∏ -->
                    <div class="token-section">
                        <div class="section-header">
                            <h2>üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏—à–∫—É</h2>
                            <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –≤ –∏–≥—Ä–µ</p>
                        </div>
                        
                        <div class="tokens-grid" id="tokens-grid">
                            <!-- –§–∏—à–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É?</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É?</p>
                <div class="modal-info">
                    <p><strong>–ö–æ–º–Ω–∞—Ç–∞:</strong> <span id="modal-room-name"></span></p>
                    <p><strong>–ò–≥—Ä–æ–∫–æ–≤ –≥–æ—Ç–æ–≤–æ:</strong> <span id="modal-ready-count">0</span>/<span id="modal-total-players">4</span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="modal-confirm">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notifications-container" id="notifications-container"></div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="notifications" class="notifications-container"></div>
    
    <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É -->
    <script src="../assets/js/utils/ModalUtils.js"></script>
    <script src="../assets/js/modules/Logger.js"></script>
    <script src="../assets/js/modules/ErrorHandler.js"></script>
    <script src="../assets/js/modules/Config.js"></script>
    
    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞ -->
    <script>
        // Fallback –¥–ª—è requestIdleCallback
        if (!window.requestIdleCallback) {
            window.requestIdleCallback = (callback) => {
                return setTimeout(callback, 1);
            };
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞
        requestIdleCallback(() => {
            const scripts = [
                '../assets/js/modules/Router.js',
                '../assets/js/modules/RoomService.js?v=1760461000',
                '../assets/js/modules/NotificationService.js',
                '../assets/js/modules/UserModel.js',
                '../assets/js/room.js?v=1760467000',
                '../assets/js/auth.js'
            ];
            
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.defer = true; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
                document.head.appendChild(script);
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ room.js
                if (src.includes('room.js')) {
                    script.onload = () => {
                        console.log('üöÄ Room.js –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
                        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                        setTimeout(() => {
                            if (typeof loadCachedRoomData === 'function') loadCachedRoomData();
                            if (typeof displayUserInfo === 'function') displayUserInfo();
                            if (typeof loadDreams === 'function') loadDreams();
                            if (typeof loadTokens === 'function') loadTokens();
                            
                            requestIdleCallback(() => {
                                if (typeof initializeServices === 'function') initializeServices();
                                if (typeof setupEventListeners === 'function') setupEventListeners();
                                if (typeof loadRoomData === 'function') loadRoomData();
                            });
                        }, 100);
                    };
                }
            });
        });
    </script>
</body>
</html>
