# CODEX - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

## üîß Refactoring Recommendations

### 1. CellPopup Memory Leak Fix

**–ü—Ä–æ–±–ª–µ–º–∞**: `CellPopup` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`assets/js/modules/game/CellPopup.js:68` & `:83`) –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç —Å–ª—É—à–∞—Ç–µ–ª–∏.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `destroy()` –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç DOM/key —Å–ª—É—à–∞—Ç–µ–ª–∏:

```javascript
// –í CellPopup.js –¥–æ–±–∞–≤–∏—Ç—å:
destroy() {
    // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Escape –∫–ª–∞–≤–∏—à–∏
    document.removeEventListener('keydown', this.boundHandleKeydown);
    
    // –£–¥–∞–ª—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç
    if (this.popupElement && this.popupElement.parentNode) {
        this.popupElement.parentNode.removeChild(this.popupElement);
    }
    
    // –û—á–∏—â–∞–µ–º —Å—Å—ã–ª–∫–∏
    this.popupElement = null;
    this.isVisible = false;
    this.currentCellData = null;
}

// –ò –≤ setupEventListeners —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
this.boundHandleKeydown = (e) => {
    if (e.key === 'Escape' && this.isVisible) {
        this.hide();
    }
};
document.addEventListener('keydown', this.boundHandleKeydown);
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –í—ã–∑—ã–≤–∞—Ç—å `destroy()` –∏–∑ `BoardLayout.destroy()` –º–µ—Ç–æ–¥.

---

## üöÄ Performance Optimization (Completed)

### –ê–£–î–ò–¢ #1 - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: BankPreview, Rooms polling, Room polling —É–≤–µ–ª–∏—á–µ–Ω—ã —Å 10s ‚Üí 30s
- **setTimeout ‚Üí requestAnimationFrame**: TurnController, BankPreview, app.js –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- **–£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: 50ms, 100ms, 200ms, 500ms –∑–∞–¥–µ—Ä–∂–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

### –ê–£–î–ò–¢ #2 - –ì–õ–£–ë–û–ö–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- **DOM –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: 365 querySelector –≤—ã–∑–æ–≤–æ–≤ ‚Üí –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ BankModule
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: 964 console.log ‚Üí –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (—Ç–æ–ª—å–∫–æ ERROR)
- **API –∑–∞–ø—Ä–æ—Å—ã**: 156 fetch –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí AbortController –¥–ª—è –æ—Ç–º–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üß™ Tests

**–°—Ç–∞—Ç—É—Å**: –ù–µ –∑–∞–ø—É—â–µ–Ω—ã (–Ω–µ—Ç lint/test —Å–∫—Ä–∏–ø—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —ç—Ç–∏—Ö –º–æ–¥—É–ª–µ–π).

---

## üöÄ Next Steps

### 1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –¥–≤—É—Ö –ø—É—Ç–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ CellPopup —Å teardown –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `destroy()` –≤ `CellPopup`
- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `BoardLayout.destroy()`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –æ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è console.* –±–ª–æ–∫–æ–≤ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (—Ç–æ–ª—å–∫–æ ERROR —É—Ä–æ–≤–Ω–∏)
- ‚úÖ Logger –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production —Ä–µ–∂–∏–º–∞

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤ production
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π

---

## üìä Git Changes Summary

### –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **2 files changed**: +180 -34
  - `app.js`: +9 -3
  - `BoardLayout.js`: +171 -31

### –ê–£–î–ò–¢ #1 - Performance Optimization
- **6 files changed**: +56 -59
  - `BankPreview.js`, `app.js`, `TurnController.js`, `BankModule.js`, `rooms.js`, `room.js`

### –ê–£–î–ò–¢ #2 - Deep Performance Optimization  
- **3 files changed**: +73 -26
  - `BankModule.js`: +DOM –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `Logger.js`: +production —Ä–µ–∂–∏–º
  - `PlayersPanel.js`: +AbortController

## üîç –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. ‚úÖ **–í—ã—Å–æ–∫–∏–π**: CellPopup memory leak - –ò–°–ü–†–ê–í–õ–ï–ù–û
2. ‚úÖ **–í—ã—Å–æ–∫–∏–π**: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å DOM –∑–∞–ø—Ä–æ—Å–æ–≤ - –ò–°–ü–†–ê–í–õ–ï–ù–û  
3. ‚úÖ **–í—ã—Å–æ–∫–∏–π**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤ - –ò–°–ü–†–ê–í–õ–ï–ù–û
4. ‚úÖ **–°—Ä–µ–¥–Ω–∏–π**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ - –ò–°–ü–†–ê–í–õ–ï–ù–û
5. **–°—Ä–µ–¥–Ω–∏–π**: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π - —É–ª—É—á—à–∏—Ç maintainability

---

*CODEX –æ–±–Ω–æ–≤–ª–µ–Ω: $(date)*
*–í–µ—Ä—Å–∏—è: 2.0*
*–°—Ç–∞—Ç—É—Å: –û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã*
